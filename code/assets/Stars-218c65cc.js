import{r as e,a as h,u as v,j as c}from"./index-46bfa3c3.js";import{ac as x,an as A,as as m,e as w,f as z,aa as j,l as C,C as P}from"./react-merge-refs.esm-2c8fb94b.js";import{P as U}from"./Preload-c122c08e.js";let f,d;const F=e.createContext(null),M=new w,E=new z,I=e.forwardRef(({children:u,range:a,limit:s=1e3,...n},r)=>{const t=e.useRef(null),[o,i]=e.useState([]),[[l,p,b]]=e.useState(()=>[new Float32Array(s*3),Float32Array.from({length:s*3},()=>1),Float32Array.from({length:s},()=>1)]);e.useEffect(()=>{t.current.geometry.attributes.position.needsUpdate=!0}),x(()=>{for(t.current.updateMatrix(),t.current.updateMatrixWorld(),M.copy(t.current.matrixWorld).invert(),t.current.geometry.drawRange.count=Math.min(s,a!==void 0?a:s,o.length),f=0;f<o.length;f++)d=o[f].current,d.getWorldPosition(E).applyMatrix4(M),E.toArray(l,f*3),t.current.geometry.attributes.position.needsUpdate=!0,d.matrixWorldNeedsUpdate=!0,d.color.toArray(p,f*3),t.current.geometry.attributes.color.needsUpdate=!0,b.set([d.size],f),t.current.geometry.attributes.size.needsUpdate=!0});const R=e.useMemo(()=>({getParent:()=>t,subscribe:y=>(i(g=>[...g,y]),()=>i(g=>g.filter(S=>S.current!==y.current)))}),[]);return e.createElement("points",h({userData:{instances:o},matrixAutoUpdate:!1,ref:A([r,t]),raycast:()=>null},n),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:m}),e.createElement("bufferAttribute",{attach:"attributes-color",count:p.length/3,array:p,itemSize:3,usage:m}),e.createElement("bufferAttribute",{attach:"attributes-size",count:b.length,array:b,itemSize:1,usage:m})),e.createElement(F.Provider,{value:R},u))}),W=e.forwardRef(({children:u,positions:a,colors:s,sizes:n,stride:r=3,...t},o)=>{const i=e.useRef(null);return x(()=>{const l=i.current.geometry.attributes;l.position.needsUpdate=!0,s&&(l.color.needsUpdate=!0),n&&(l.size.needsUpdate=!0)}),e.createElement("points",h({ref:A([o,i])},t),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:a.length/r,array:a,itemSize:r,usage:m}),s&&e.createElement("bufferAttribute",{attach:"attributes-color",count:s.length/r,array:s,itemSize:3,usage:m}),n&&e.createElement("bufferAttribute",{attach:"attributes-size",count:n.length/r,array:n,itemSize:1,usage:m})),u)}),D=e.forwardRef((u,a)=>u.positions instanceof Float32Array?e.createElement(W,h({},u,{ref:a})):e.createElement(I,h({},u,{ref:a}))),G=u=>{const a=e.useRef(),[s]=e.useState(()=>{const n=new Float32Array(15e3);for(let r=0;r<n.length;r+=3){const t=1.2*Math.cbrt(Math.random()),o=Math.random()*2*Math.PI,i=Math.acos(2*Math.random()-1);n[r]=t*Math.sin(i)*Math.cos(o),n[r+1]=t*Math.sin(i)*Math.sin(o),n[r+2]=t*Math.cos(i)}return n});return x((n,r)=>{a.current.rotation.x-=r/10,a.current.rotation.y-=r/15}),c.jsx("group",{rotation:[0,0,Math.PI/4],children:c.jsx(D,{ref:a,positions:s,stride:3,frustumCulled:!0,...u,children:c.jsx("primitive",{object:new C({transparent:!0,size:.003,sizeAttenuation:!0,color:new P("#ffe0a5"),depthWrite:!1})})})})},B=()=>{const{setContext:u}=v(),a=e.useRef(),[s,n]=e.useState(!1);e.useEffect(()=>{const t=a.current,o=new IntersectionObserver(([i])=>{n(i.isIntersecting)});return t&&o.observe(t),()=>{t&&o.unobserve(t)}},[]);const r=({gl:t})=>{u(t)};return c.jsx("div",{className:"w-full h-auto absolute inset-0 z-[-1]",ref:a,children:s&&c.jsxs(j,{camera:{position:[0,0,1]},onCreated:r,children:[c.jsx(e.Suspense,{fallback:null,children:c.jsx(G,{})}),c.jsx(U,{all:!0})]})})};export{B as default};
